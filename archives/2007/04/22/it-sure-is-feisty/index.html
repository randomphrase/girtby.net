<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>girtby.net &#8211;   It Sure Is Feisty</title>

<meta name="verify-v1" content="unGvQ7Jwj5liZb2PzH2ckduvpe8Ua3Ls0MONzCHQQn4=" />

<link rel="stylesheet" href="http://girtby.net/wp-content/themes/depo-clean/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/atom+xml" title="girtby.net Articles Feed" href="http://girtby.net/feed/atom/" />
<link rel="alternate" type="application/atom+xml" title="girtby.net Comments Feed" href="http://girtby.net/comments/feed/atom/" />

<link rel="openid.server" href="http://www.myopenid.com/server" />
<link rel="openid.delegate" href="http://arankine.myopenid.com/" />

<link rel="meta" href="http://girtby.net/labels.rdf" type="application/rdf+xml" title="ICRA labels" />
<meta http-equiv="pics-Label" content='(pics-1.1 "http://www.icra.org/pics/vocabularyv03/" l gen true for "http://girtby.net" r (n 0 s 0 v 0 l 2 oa 0 ob 0 oc 0 od 0 oe 0 of 0 og 0 oh 0 c 1) gen true for "http://www.girtby.net" r (n 0 s 0 v 0 l 2 oa 0 ob 0 oc 0 od 0 oe 0 of 0 og 0 oh 0 c 1))' />

<link rel="prev" href="http://girtby.net/archives/2007/04/07/welcome-to-my-cave/" />
<link rel="next" href="http://girtby.net/archives/2007/04/29/personal-wikis/" />

<link rel="pingback" href="http://girtby.net/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="girtby.net &raquo; Feed" href="http://girtby.net/feed/" />
<link rel="alternate" type="application/rss+xml" title="girtby.net &raquo; Comments Feed" href="http://girtby.net/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="girtby.net &raquo; It Sure Is Feisty Comments Feed" href="http://girtby.net/archives/2007/04/22/it-sure-is-feisty/feed/" />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js'></script>
<script type='text/javascript' src='http://girtby.net/wp-content/themes/depo-clean/javascript/friendly_dates.js?ver=2.9-rare'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://girtby.net/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://girtby.net/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='girtby.net' href='http://girtby.net' />
<link rel='start' title='Thunderbirds Are Go-ne' href='http://girtby.net/archives/2004/09/20/thunderbirds-are-go-ne/' />
<link rel='prev' title='Welcome To My Cave' href='http://girtby.net/archives/2007/04/07/welcome-to-my-cave/' />
<link rel='next' title='Personal Wikis' href='http://girtby.net/archives/2007/04/29/personal-wikis/' />
<meta name="generator" content="WordPress 2.9-rare" />
<link rel='canonical' href='http://girtby.net/archives/2007/04/22/it-sure-is-feisty/' />
			<script type="text/javascript" src="http://girtby.net/wp-content/plugins/flickr-tag/js/flickrTagTooltips.js"></script>

			<link href="http://girtby.net/wp-content/plugins/flickr-tag/css/flickrTagTooltips.css" type="text/css" rel="stylesheet"/>
	
		<link href="http://girtby.net/wp-content/plugins/flickr-tag/css/flickrTag.css" type="text/css" rel="stylesheet"/>
	</head>
<body>
<div class="container">
	<div class="header">
        <div class="search">
            <form method="get" id="sform" action="http://girtby.net/">
                <input type="text" id="q" value="" name="s" size="15" />
			</form>
        </div><!-- end search -->
        			        <h1><a href="http://girtby.net/">this blog is girtby.net</a> 
            </h1>
	</div><!-- end header -->


<div class="blogads">

<!-- Your Stuff Here -->

</div>


    						
      <div class="post">
          <div class="metainfo">
              <p>Posted<br />
                <abbr class="published" title="Sun, 22 Apr 2007 12:11:05 -0400">22 April 2007 @ 12pm</abbr></p>
                <p>Tagged<br />
                <a href="http://girtby.net/archives/category/nerd-factor-x/" title="View all posts in Nerd Factor X" rel="category tag">Nerd Factor X</a></p>
                		    </div>
		    <div class="content">
		        <h3>It Sure Is Feisty 
		        </h3>
		        <p>I wish I could say that my experience upgrading to <a href="http://www.ubuntu.com/getubuntu/releasenotes/704tour">Ubuntu 7.04</a> was delightful.</p>

<p>Last Friday I invoked the handy updater tool. After a couple of hours of downloading (from the Internode mirror, thanks) and installing the new software, I rebooted to find&#8230;</p>

<p>A blank screen.</p>

<p>Not just that, but a completely unresponsive computer. It had almost completed initialising, just to the point of loading X. After the screen went blank though, it wouldn&#8217;t exit X to the text console. In fact, it wouldn&#8217;t even respond to pings.</p>

<p>So began a weekend attempting to diagnose the blank screen. I soon isolated it to a problem with the nVidia proprietary drivers, but no solutions were forthcoming.</p>

<p>The <a href="http://ubuntuforums.org/">Ubuntu Forums</a> are a bit of a blessing and a curse in my experience. There is just <em>so much</em> traffic there, which is good, but there is a fairly low signal-to-noise ratio, which is bad. When I was diagnosing <a href="/articles/2006/12/7/the-switch#comment-756">RAID disk problems</a>, I found many threads that had become inundated with folks describing similar-but-different problems (or even completely different problems), and with others proposing half-arsed solutions. It&#8217;s often quite difficult wade through it all to a real solution to any given problem.</p>

<p>After some time wading, I tried a different tack. The following ominous message appeared early in the boot sequence, and it bugged me:</p>

<pre><code>agpgart: Detected AGP bridge 0
agpgart: Aperture conflicts with PCI mapping.
agpgart: Aperture from AGP @ f0000000 size 4096 MB
agpgart: Aperture too small (0 MB)
agpgart: No usable aperture found.
agpgart: Consider rebooting with iommu=memaper=2 to get a good aperture.
PCI-DMA: Disabling IOMMU.
</code></pre>

<p>So I tried the obvious, rebooting with <code>iommu=memaper=2</code>. This was no good, but a bit of googling led me to <a href="http://www.nvnews.net/vbulletin/showthread.php?t=83419">this nV News Forums post</a>, where someone is describing very similar symptoms to mine, and getting response from an nVidia engineer. There was no resolution, but from this thread I learned two important facts:</p>

<ol>
<li>That some recent changes were made in the kernel in the area of IOMMU and aperture size.</li>
<li>The existence of <code>iommu=noaperture</code>.</li>
</ol>

<p>The second piece of information was the one that eventually solved my problem, namely adding <code>iommu=noaperture</code> to the kernel boot line.</p>

<p>The solution is really sub-optimal because it results in a 32MB aperture, and <a href="http://www.uwsg.iu.edu/hypermail/linux/kernel/0509.2/1972.html">apparently</a> 64MB is the useful minimum. However I can say that 32MB does at least allow the system to load the nVidia drivers and run at an acceptable speed. In fact it runs beautifully.</p>

<p>It seems likely that fixing this problem would almost certainly have fixed the appalling graphics performance with the old 6.10 version. Whereas in the old kernel, the lack of a usable AGP aperture resulted in performance problems, in the new kernel it simply refused to work at all.</p>

<p>Of course it has to be asked: why wasn&#8217;t this caught in testing?</p>

<p>My theory is that this problem is caused by a combination of: an AMD x86-64 CPU, AGP graphics, and a particular type of BIOS that, for some reason, doesn&#8217;t set/report the correct AGP aperture size.</p>

<p>As for the chance of your average human being able to diagnose any of this. Well. I&#8217;ll leave it up to you humans to decide.</p>
		        <br clear="left" />
		    </div>
        </div><!-- end post -->

			
<!-- You can start editing here. -->


<div id="comments" class="post">

	<h3 class="comments_headers">7 Comments</h3>

</div>
	
	
			
        <div class="post" id="comment-1579">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://bjkeefe.blogspot.com/' rel='external nofollow' class='url'>bjkeefe</a><br />
                <input type="hidden" name="post_date" value="Sun, 22 Apr 2007 12:11:05 -0400" />
                <abbr class="commented" title="Sun, 22 Apr 2007 12:11:05 -0400">22 April 2007 @ 12pm</abbr><br />
                <a href="#comment-1579">#</a></p>
			</div>
			<div class="content">
				<p>My condolences.</p>

<p>You&#8217;re quite right to call out Ubuntu for missing this hardware problem &#8212; your hardware doesn&#8217;t sound overly exotic.</p>

<p>Sorry if I didn&#8217;t read carefully enough, but would you please be more explicit about what you did that &#8220;eventually solved [your] problem&#8221;?  Thanks.</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-1580">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://marxyblog.blogspot.com/' rel='external nofollow' class='url'>marxy</a><br />
                <input type="hidden" name="post_date" value="Sun, 22 Apr 2007 12:11:05 -0400" />
                <abbr class="commented" title="Sun, 22 Apr 2007 12:11:05 -0400">22 April 2007 @ 12pm</abbr><br />
                <a href="#comment-1580">#</a></p>
			</div>
			<div class="content">
				<p>The great thing is that you could see &#8220;agpgart: No usable aperture found.&#8221; etc during the boot sequence.</p>

<p>I purchased a system from a PC shop a while back and noticed that the hardware guy booted it up with a linux liveCD before handing it over, when I commented on this he explained that booting linux is an excellent test and diagnostic of the hardware, better than just the bios and more helpful by far than Windows.</p>

<p>My Ubuntu 7.04 was completely smooth, but then I have very generic intel hardware. Ubuntu has surged ahead of Fedora on the desktop, but I still use FC6 as a server mostly due to familliarity.</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-1581">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://girtby.net' rel='external nofollow' class='url'>Alastair</a><br />
                <input type="hidden" name="post_date" value="Sun, 22 Apr 2007 12:11:05 -0400" />
                <abbr class="commented" title="Sun, 22 Apr 2007 12:11:05 -0400">22 April 2007 @ 12pm</abbr><br />
                <a href="#comment-1581">#</a></p>
			</div>
			<div class="content">
				<p>Reworded slightly. The solution was adding <code>iommu=noaperture</code> to the kernel boot line.</p>

<p>Also, I&#8217;d like to call Ubuntu on this, but I&#8217;m conscious that the nVidia drivers are &#8220;restricted&#8221; and hence explicitly <em>excluded</em> from the standard Ubuntu base. I <em>guess</em> that the testing responsibility falls on nVidia&#8217;s shoulders, but I can&#8217;t imagine that the BIOS/motherboard vendor (Award/Gigabyte) is entirely in the clear.</p>

<p>Another possible lesson from all this is that there is a distinct need for systems integrators &#8211; vendors who can provide combined hardware and software that has had some testing and hence some guarantee against problems like this.</p>

<p>Maybe it can be open-sourced? That is, a collaborative environment for authoring a test suite, and a catalogue of knowledge on how to source and assemble appropriate hardware (with specific makes and models) and software to pass the test suite. The result would be a set of &#8220;known good&#8221; hardware, not just as components, but as entire systems including components and configuration. Maybe there is something like this out there already?</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-1582">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://brainsnorkel.com' rel='external nofollow' class='url'>Chris</a><br />
                <input type="hidden" name="post_date" value="Sun, 22 Apr 2007 12:11:05 -0400" />
                <abbr class="commented" title="Sun, 22 Apr 2007 12:11:05 -0400">22 April 2007 @ 12pm</abbr><br />
                <a href="#comment-1582">#</a></p>
			</div>
			<div class="content">
				<p>It seems you&#8217;re not the only one with <a href="http://pl.atyp.us/wordpress/?p=1212">video problems</a> with Feisty Fawn.</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-1583">
		    <div class="metainfo">
                <p>Posted by<br />yetanothersteve<br />
                <input type="hidden" name="post_date" value="Sun, 22 Apr 2007 12:11:05 -0400" />
                <abbr class="commented" title="Sun, 22 Apr 2007 12:11:05 -0400">22 April 2007 @ 12pm</abbr><br />
                <a href="#comment-1583">#</a></p>
			</div>
			<div class="content">
				<p>I have a Gigabyte K8NS-939, Athlon 64 X2 system and saw the same &#8220;No usable aperture found.&#8221; message. There was a special hidden setting in the Bios setup where I had to hit &#8220;Ctrl-F1&#8243; to activate the Advanced Chipset Menu. After that, I was able to change the AGP aperture in the Bios and the dmesg entries then became a message stating that the AGP Aperture had been set to 128mb, which is what I chose in the Bios. No changes to kernel boot parameters or modules required. Your motherboard manufacturer may have also hidden the AGP aperture setting or even called it something else.</p>

<p>FYI, the iommu=noaperture did help because I tried it before finding the Bios setting, but it forced the aperture to be 32mb, which is small for my 128mb NVidia GeForce 6800XT card.</p>

<p>Using the quick &#8220;not really a benchmark but it does give a number&#8221; &#8220;glxgears -printfps&#8221; test, I went from 6200 fps to 9100 fps using either the bios change or iommu=noaperture. I may reinstall Quake4 and see if that performance is improved.</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-1584">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://kappia.com' rel='external nofollow' class='url'>beniji</a><br />
                <input type="hidden" name="post_date" value="Sun, 22 Apr 2007 12:11:05 -0400" />
                <abbr class="commented" title="Sun, 22 Apr 2007 12:11:05 -0400">22 April 2007 @ 12pm</abbr><br />
                <a href="#comment-1584">#</a></p>
			</div>
			<div class="content">
				<p>FYI The nVidia AGP aperture size causes problems for MS Windows too &#8211; it occurs on my Shuttle XPC running Windows 2000 if the BIOS AGP settings are not spot on. Unlike Feisty (which did the same thing as you experienced on my Tecra laptop), Windows does boot and use the video hardware but will crash every few minutes.</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-1585">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://daysite.net' rel='external nofollow' class='url'>Jon Day</a><br />
                <input type="hidden" name="post_date" value="Sun, 22 Apr 2007 12:11:05 -0400" />
                <abbr class="commented" title="Sun, 22 Apr 2007 12:11:05 -0400">22 April 2007 @ 12pm</abbr><br />
                <a href="#comment-1585">#</a></p>
			</div>
			<div class="content">
				<p>Thank you Sir!!  After much research, your solution worked great.  Eliminated the slow jerky screens, poor scrolling, and a host of other related problems.</p>

<p>Fedora 8
AMD 64
Biostar TForce 6100-939 (mother board)
Acer 22&#8243; AL2216W (flat monitor)
MSI NX8500GT (nVidia video card)</p> 
							</div>
		<br clear="left" />
		</div>
		
	

	<!-- Comment Form -->

	    

			
				
<div class="posttopline">
	<span class="previous">&larr; <a href="http://girtby.net/archives/2007/04/07/welcome-to-my-cave/" rel="prev">Welcome To My Cave</a></span>
	<span class="next"><a href="http://girtby.net/archives/2007/04/29/personal-wikis/" rel="next">Personal Wikis</a> &rarr;</span>
</div>

<br clear="all" />

    <div class="footer">
		
        <div class="first">
        <div id="text-318154731" class="widget widget_text"><h5 class="widgettitle">Archives</h5>			<div class="textwidget"><ul>
<li><a href="/archives/2009">2009</a></li>
<li><a href="/archives/2008">2008</a></li>
<li><a href="/archives/2007">2007</a></li>
<li><a href="/archives/2006">2006</a></li>
<li><a href="/archives/2005">2005</a></li>
<li><a href="/archives/2004">2004</a></li>
</ul></div>
		</div>		</div>

        <div class="sidebar">
        <div id="text-326846052" class="widget widget_text"><h5 class="widgettitle">Leveraged Synergy</h5>			<div class="textwidget"><p>Hello, I&#8217;m Alastair Rankine. I once had a blog, and you've found it. <a href="/about/">Would you like to know more?</a></p>
<p>From time to time I made offerings to the internet. <a href="/offerings/">Would you like some?</a></p>
</div>
		</div>        </div>

        <div class="last">
        <div id="linkcat-2" class="widget widget_links"><h5 class="widgettitle">Blogroll</h5>
	<ul class='xoxo blogroll'>
<li><a href="http://bjkeefe.blogspot.com">bjkeefe</a></li>
<li><a href="http://brainsnorkel.com">brainsnorkel</a></li>
<li><a href="http://deadlybloodyserious.com">Deadly Bloody Serious</a></li>
<li><a href="http://blog.alphajuliet.com/">follicle</a></li>
<li><a href="http://madbean.com/">madbean</a></li>
<li><a href="http://marxyblog.blogspot.com">marxy&#8217;s musing on technology</a></li>
<li><a href="http://mattrubinstein.com.au">mattrubinstein.com.au</a></li>
<li><a href="http://somethinkodd.com/oddthinking">OddThinking</a></li>

	</ul>
</div>
        </div>

	    </div><!-- end footer -->

        <br clear="all" />
        
		<div class="copyright">
        	        	<span class="previous">&larr; <a href="http://girtby.net">Back to Home</a></span>
                        <p>Powered by <a href="http://wordpress.org">WordPress</a> using the <a href="http://powazek.com/posts/516">DePo Clean Theme</a> <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/au/"><img alt="Creative Commons License" class="badge" width=80 height=15 src="http://i.creativecommons.org/l/by-sa/2.5/au/80x15.png" /></a></p>
            		</div>

	</div> <!-- end container -->
</body>
</html>
