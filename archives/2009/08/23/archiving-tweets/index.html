<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>girtby.net &#8211;   Archiving Tweets</title>

<meta name="verify-v1" content="unGvQ7Jwj5liZb2PzH2ckduvpe8Ua3Ls0MONzCHQQn4=" />

<link rel="stylesheet" href="http://girtby.net/wp-content/themes/depo-clean/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/atom+xml" title="girtby.net Articles Feed" href="http://girtby.net/feed/atom/" />
<link rel="alternate" type="application/atom+xml" title="girtby.net Comments Feed" href="http://girtby.net/comments/feed/atom/" />

<link rel="openid.server" href="http://www.myopenid.com/server" />
<link rel="openid.delegate" href="http://arankine.myopenid.com/" />

<link rel="meta" href="http://girtby.net/labels.rdf" type="application/rdf+xml" title="ICRA labels" />
<meta http-equiv="pics-Label" content='(pics-1.1 "http://www.icra.org/pics/vocabularyv03/" l gen true for "http://girtby.net" r (n 0 s 0 v 0 l 2 oa 0 ob 0 oc 0 od 0 oe 0 of 0 og 0 oh 0 c 1) gen true for "http://www.girtby.net" r (n 0 s 0 v 0 l 2 oa 0 ob 0 oc 0 od 0 oe 0 of 0 og 0 oh 0 c 1))' />

<link rel="prev" href="http://girtby.net/archives/2009/08/03/sleeping-bloggy/" />
<link rel="next" href="http://girtby.net/archives/2009/09/18/last-post/" />

<link rel="pingback" href="http://girtby.net/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="girtby.net &raquo; Feed" href="http://girtby.net/feed/" />
<link rel="alternate" type="application/rss+xml" title="girtby.net &raquo; Comments Feed" href="http://girtby.net/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="girtby.net &raquo; Archiving Tweets Comments Feed" href="http://girtby.net/archives/2009/08/23/archiving-tweets/feed/" />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js'></script>
<script type='text/javascript' src='http://girtby.net/wp-content/themes/depo-clean/javascript/friendly_dates.js?ver=2.9-rare'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://girtby.net/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://girtby.net/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='girtby.net' href='http://girtby.net' />
<link rel='start' title='Thunderbirds Are Go-ne' href='http://girtby.net/archives/2004/09/20/thunderbirds-are-go-ne/' />
<link rel='prev' title='Sleeping Bloggy' href='http://girtby.net/archives/2009/08/03/sleeping-bloggy/' />
<link rel='next' title='Last Post!' href='http://girtby.net/archives/2009/09/18/last-post/' />
<meta name="generator" content="WordPress 2.9-rare" />
<link rel='canonical' href='http://girtby.net/archives/2009/08/23/archiving-tweets/' />
			<script type="text/javascript" src="http://girtby.net/wp-content/plugins/flickr-tag/js/flickrTagTooltips.js"></script>

			<link href="http://girtby.net/wp-content/plugins/flickr-tag/css/flickrTagTooltips.css" type="text/css" rel="stylesheet"/>
	
		<link href="http://girtby.net/wp-content/plugins/flickr-tag/css/flickrTag.css" type="text/css" rel="stylesheet"/>
	</head>
<body>
<div class="container">
	<div class="header">
        <div class="search">
            <form method="get" id="sform" action="http://girtby.net/">
                <input type="text" id="q" value="" name="s" size="15" />
			</form>
        </div><!-- end search -->
        			        <h1><a href="http://girtby.net/">this blog is girtby.net</a> 
            </h1>
	</div><!-- end header -->


<div class="blogads">

<!-- Your Stuff Here -->

</div>


    						
      <div class="post">
          <div class="metainfo">
              <p>Posted<br />
                <abbr class="published" title="Sun, 23 Aug 2009 23:14:05 -0400">23 August 2009 @ 11pm</abbr></p>
                <p>Tagged<br />
                <a href="http://girtby.net/archives/category/nerd-factor-x/" title="View all posts in Nerd Factor X" rel="category tag">Nerd Factor X</a></p>
                <p>Tags<br/><a href="http://girtby.net/archives/tag/archive/" rel="tag">archive</a>, <a href="http://girtby.net/archives/tag/backup/" rel="tag">backup</a>, <a href="http://girtby.net/archives/tag/twitter/" rel="tag">twitter</a></p>		    </div>
		    <div class="content">
		        <h3>Archiving Tweets 
		        </h3>
		        <p>If you&#8217;ve run <a href="http://dcortesi.com/2009/07/16/for-wil-wheaton/">Damon Cortesi&#8217;s handy curl command</a> to download all (or the last 3200) tweets from your twitter account, you&#8217;ll have a directory full of files with names like <code>user_timeline.xml?count=100&amp;page=1</code>. Not only that but they include a large amount of redundant profile stuff in the <code>&lt;user&gt;</code> element. And not only <em>that</em>, but twitter sometimes returns a &#8220;Twitter is over capacity&#8221; page instead of your tweets.</p>

<p>What we want to do is a) detect any files which don&#8217;t contain tweets, b) remove the redundant user profile, and c) combine the results into a single file.</p>

<p>Well, friends, here is a shell script to do exactly that. You&#8217;ll need zsh and xsltproc, both of which are standard on MacOS X and most sane Linuxen.</p>

<div class="aside"><p>zsh is needed to sort the input files in numeric, as opposed to lexicographic, order. If you know of a way to do this in bash, let me know&#8230;</p></div>

<p>Output is on stdout, so just redirect to your filename of choice:</p>

<pre><code>$ tweetcombine user_timeline.xml\?count=100\&amp;page=* \
    &gt; tweet_archive.xml
</code></pre>

<p><span id="more-3905"></span>Here&#8217;s the script:</p>

<pre><code>#!/bin/zsh

# Combine all of the twitter user_timeline.xml files specified on the command line into a single output
# Written by Alastair Rankine, http://girtby.net
# Licensed as Creative Commons BY-SA

input_args=()
for f in ${(on)*}; do
    [[ -f $f ]] || exit "Not a file: $f"
    input_args+="&lt;input&gt;${f//&amp;/&amp;amp;}&lt;/input&gt;"
done

xsltproc - &lt;&lt;EOF
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE inputs [
  &lt;!ATTLIST xsl:stylesheet id ID #REQUIRED&gt;
]&gt;
&lt;?xml-stylesheet type="text/xml" href="#style1"?&gt;
&lt;inputs&gt;
  ${input_args}

  &lt;xsl:stylesheet id="style1" version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;

    &lt;xsl:output type="xml" indent="yes"/&gt;

    &lt;xsl:template match="*"&gt;
      &lt;xsl:copy&gt;
        &lt;xsl:copy-of select="@*"/&gt;
        &lt;xsl:apply-templates/&gt;
      &lt;/xsl:copy&gt;
    &lt;/xsl:template&gt;

    &lt;xsl:template match="statuses"&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/xsl:template&gt;

    &lt;xsl:template match="user"/&gt;

    &lt;xsl:template match="xsl:stylesheet"/&gt;

    &lt;xsl:template match="input"&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test="document(.)/statuses"&gt;
          &lt;xsl:apply-templates select="document(.)"/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:otherwise&gt;
          &lt;xsl:message terminate="yes"&gt;&lt;xsl:value-of select="."/&gt; does not contain statuses element&lt;/xsl:message&gt;
        &lt;/xsl:otherwise&gt;
      &lt;/xsl:choose&gt;
    &lt;/xsl:template&gt;

    &lt;xsl:template match="inputs"&gt;
      &lt;statuses type="array"&gt;
        &lt;xsl:apply-templates/&gt;
      &lt;/statuses&gt;
    &lt;/xsl:template&gt;

  &lt;/xsl:stylesheet&gt;
&lt;/inputs&gt;
EOF
</code></pre>

<p>I think this method of sticking filename arguments into an XSL document with an embedded stylesheet is quite a powerful way of processing XML documents with shell scripts. (Probably should put the <code>&lt;input&gt;</code> tags into a separate namespace though&#8230;)</p>
		        <br clear="left" />
		    </div>
        </div><!-- end post -->

			
<!-- You can start editing here. -->


<div id="comments" class="post">

	<h3 class="comments_headers">3 Comments</h3>

</div>
	
	
			
        <div class="post" id="comment-14634">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://plasmasturm.org/' rel='external nofollow' class='url'>Aristotle Pagaltzis</a><br />
                <input type="hidden" name="post_date" value="Sun, 23 Aug 2009 23:14:05 -0400" />
                <abbr class="commented" title="Mon, 24 Aug 2009 03:40:35 -0400">24 August 2009 @ 3am</abbr><br />
                <a href="#comment-14634">#</a></p>
			</div>
			<div class="content">
				<p>A weird sort of power.</p>

<ol>
<li>You can use <code>[01-32]</code> instead of <code>[1-32]</code> to get filenames with correctly sorting names and with the <code>-o</code> switch you can clean up the filenames further.</li>
<li>You can download JSON rather than XML.</li>
</ol>

<p>Bottom line:</p>

<pre><code>curl -k -u user:pass -o tweets-#1.json 'https://twitter.com/statuses/user&#95;timeline.json?count=100&amp;page=[01-32]'
perl -MJSON::XS -E'@s=map{local@ARGV=$&#95;;@{decode&#95;json&lt;&gt;}}@ARGV;delete@{$&#95;}{qw(user source)}for@s;say encode&#95;json\@s' -- tweets-* | json&#95;xs
</code></pre>

<p>Tad easierâ€¦</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-14638">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://girtby.net' rel='external nofollow' class='url'>alastair</a><br />
                <input type="hidden" name="post_date" value="Sun, 23 Aug 2009 23:14:05 -0400" />
                <abbr class="commented" title="Mon, 24 Aug 2009 10:31:48 -0400">24 August 2009 @ 10am</abbr><br />
                <a href="#comment-14638">#</a></p>
			</div>
			<div class="content">
				<p>A weird sort of easier:</p>

<pre><code>% curl -k -u randomphrase:shh -o tweets-#1.json ...
zsh: no matches found: tweets-#1.json
% curl -k -u randomphrase:shh -o tweets-\#1.json ...
[...]
% perl -MJSON::XS -E'...' -- tweets-* | json&amp;#95;xs
zsh: command not found: json&amp;#95;xs
Can't locate JSON/XS.pm in @INC (@INC contains: ... )
.
BEGIN failed--compilation aborted.
</code></pre>

<p>Despite the snarky comment above, yes it does work nicely after installing libjson-xs-perl.</p>

<p>Another nice to have would be to resolve shortened URLs &#8211; this is probably a lot easier to do in Perl than XSLT&#8230;</p>

<p>BTW: Your comment was marked as &#8220;Very Spammy&#8221; by Defensio, and had to be manually rescued. This makes me sad.</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-14641">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://plasmasturm.org/' rel='external nofollow' class='url'>Aristotle Pagaltzis</a><br />
                <input type="hidden" name="post_date" value="Sun, 23 Aug 2009 23:14:05 -0400" />
                <abbr class="commented" title="Mon, 24 Aug 2009 16:14:21 -0400">24 August 2009 @ 4pm</abbr><br />
                <a href="#comment-14641">#</a></p>
			</div>
			<div class="content">
				<p>I concede that <a href="http://search.cpan.org/perldoc?JSON::XS" rel="nofollow">JSON::XS</a> is less likely to be installed than libxslt.</p>

<p>I started out with your stylesheet actually, but eventually I got to annoyed at all the effort that XSLT takes for very simple cases like this one.</p>

<p>The deciding factor was JSON + dynamic language, so Ruby would work as well as Perl here; I guess it would look cleaner at the expense of a longer command. (Pythonâ€™s not much for one-liners, however.) Of course youâ€™d ultimately put this in a script, so thatâ€™s neither here nor there.</p>

<p>As for the spamminess, that was probably because somehow all the underscores in my code block got turned into <code>&#95;</code> character references, and ASCII characters spelled as NCRs is a popular filter blinding technique. (On both sides of the war, actually â€“ <em>we</em> use it <em>against</em> spammers too, c.f. <code>mailto:</code> hiding.)</p> 
							</div>
		<br clear="left" />
		</div>
		
	

	<!-- Comment Form -->

	    

			
				
<div class="posttopline">
	<span class="previous">&larr; <a href="http://girtby.net/archives/2009/08/03/sleeping-bloggy/" rel="prev">Sleeping Bloggy</a></span>
	<span class="next"><a href="http://girtby.net/archives/2009/09/18/last-post/" rel="next">Last Post!</a> &rarr;</span>
</div>

<br clear="all" />

    <div class="footer">
		
        <div class="first">
        <div id="text-318154731" class="widget widget_text"><h5 class="widgettitle">Archives</h5>			<div class="textwidget"><ul>
<li><a href="/archives/2009">2009</a></li>
<li><a href="/archives/2008">2008</a></li>
<li><a href="/archives/2007">2007</a></li>
<li><a href="/archives/2006">2006</a></li>
<li><a href="/archives/2005">2005</a></li>
<li><a href="/archives/2004">2004</a></li>
</ul></div>
		</div>		</div>

        <div class="sidebar">
        <div id="text-326846052" class="widget widget_text"><h5 class="widgettitle">Leveraged Synergy</h5>			<div class="textwidget"><p>Hello, I&#8217;m Alastair Rankine. I once had a blog, and you've found it. <a href="/about/">Would you like to know more?</a></p>
<p>From time to time I made offerings to the internet. <a href="/offerings/">Would you like some?</a></p>
</div>
		</div>        </div>

        <div class="last">
        <div id="linkcat-2" class="widget widget_links"><h5 class="widgettitle">Blogroll</h5>
	<ul class='xoxo blogroll'>
<li><a href="http://bjkeefe.blogspot.com">bjkeefe</a></li>
<li><a href="http://brainsnorkel.com">brainsnorkel</a></li>
<li><a href="http://deadlybloodyserious.com">Deadly Bloody Serious</a></li>
<li><a href="http://blog.alphajuliet.com/">follicle</a></li>
<li><a href="http://madbean.com/">madbean</a></li>
<li><a href="http://marxyblog.blogspot.com">marxy&#8217;s musing on technology</a></li>
<li><a href="http://mattrubinstein.com.au">mattrubinstein.com.au</a></li>
<li><a href="http://somethinkodd.com/oddthinking">OddThinking</a></li>

	</ul>
</div>
        </div>

	    </div><!-- end footer -->

        <br clear="all" />
        
		<div class="copyright">
        	        	<span class="previous">&larr; <a href="http://girtby.net">Back to Home</a></span>
                        <p>Powered by <a href="http://wordpress.org">WordPress</a> using the <a href="http://powazek.com/posts/516">DePo Clean Theme</a> <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/au/"><img alt="Creative Commons License" class="badge" width=80 height=15 src="http://i.creativecommons.org/l/by-sa/2.5/au/80x15.png" /></a></p>
            		</div>

	</div> <!-- end container -->
</body>
</html>
