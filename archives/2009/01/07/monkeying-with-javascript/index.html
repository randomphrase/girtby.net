<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>girtby.net &#8211;   Monkeying With JavaScript</title>

<meta name="verify-v1" content="unGvQ7Jwj5liZb2PzH2ckduvpe8Ua3Ls0MONzCHQQn4=" />

<link rel="stylesheet" href="http://girtby.net/wp-content/themes/depo-clean/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/atom+xml" title="girtby.net Articles Feed" href="http://girtby.net/feed/atom/" />
<link rel="alternate" type="application/atom+xml" title="girtby.net Comments Feed" href="http://girtby.net/comments/feed/atom/" />

<link rel="openid.server" href="http://www.myopenid.com/server" />
<link rel="openid.delegate" href="http://arankine.myopenid.com/" />

<link rel="meta" href="http://girtby.net/labels.rdf" type="application/rdf+xml" title="ICRA labels" />
<meta http-equiv="pics-Label" content='(pics-1.1 "http://www.icra.org/pics/vocabularyv03/" l gen true for "http://girtby.net" r (n 0 s 0 v 0 l 2 oa 0 ob 0 oc 0 od 0 oe 0 of 0 og 0 oh 0 c 1) gen true for "http://www.girtby.net" r (n 0 s 0 v 0 l 2 oa 0 ob 0 oc 0 od 0 oe 0 of 0 og 0 oh 0 c 1))' />

<link rel="prev" href="http://girtby.net/archives/2008/12/29/software-that-goes-clunk/" />
<link rel="next" href="http://girtby.net/archives/2009/01/11/they-dont-call-it-hardware-for-nothing/" />

<link rel="pingback" href="http://girtby.net/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="girtby.net &raquo; Feed" href="http://girtby.net/feed/" />
<link rel="alternate" type="application/rss+xml" title="girtby.net &raquo; Comments Feed" href="http://girtby.net/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="girtby.net &raquo; Monkeying With JavaScript Comments Feed" href="http://girtby.net/archives/2009/01/07/monkeying-with-javascript/feed/" />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js'></script>
<script type='text/javascript' src='http://girtby.net/wp-content/themes/depo-clean/javascript/friendly_dates.js?ver=2.9-rare'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://girtby.net/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://girtby.net/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='girtby.net' href='http://girtby.net' />
<link rel='start' title='Thunderbirds Are Go-ne' href='http://girtby.net/archives/2004/09/20/thunderbirds-are-go-ne/' />
<link rel='prev' title='Software That Goes Clunk' href='http://girtby.net/archives/2008/12/29/software-that-goes-clunk/' />
<link rel='next' title='They Don&#8217;t Call it Hardware for Nothing' href='http://girtby.net/archives/2009/01/11/they-dont-call-it-hardware-for-nothing/' />
<meta name="generator" content="WordPress 2.9-rare" />
<link rel='canonical' href='http://girtby.net/archives/2009/01/07/monkeying-with-javascript/' />
			<script type="text/javascript" src="http://girtby.net/wp-content/plugins/flickr-tag/js/flickrTagTooltips.js"></script>

			<link href="http://girtby.net/wp-content/plugins/flickr-tag/css/flickrTagTooltips.css" type="text/css" rel="stylesheet"/>
	
		<link href="http://girtby.net/wp-content/plugins/flickr-tag/css/flickrTag.css" type="text/css" rel="stylesheet"/>
	</head>
<body>
<div class="container">
	<div class="header">
        <div class="search">
            <form method="get" id="sform" action="http://girtby.net/">
                <input type="text" id="q" value="" name="s" size="15" />
			</form>
        </div><!-- end search -->
        			        <h1><a href="http://girtby.net/">this blog is girtby.net</a> 
            </h1>
	</div><!-- end header -->


<div class="blogads">

<!-- Your Stuff Here -->

</div>


    						
      <div class="post">
          <div class="metainfo">
              <p>Posted<br />
                <abbr class="published" title="Wed, 07 Jan 2009 22:31:12 -0500">7 January 2009 @ 10pm</abbr></p>
                <p>Tagged<br />
                <a href="http://girtby.net/archives/category/meta/" title="View all posts in Meta" rel="category tag">Meta</a>,  <a href="http://girtby.net/archives/category/nerd-factor-x/" title="View all posts in Nerd Factor X" rel="category tag">Nerd Factor X</a></p>
                <p>Tags<br/><a href="http://girtby.net/archives/tag/javascript/" rel="tag">javascript</a>, <a href="http://girtby.net/archives/tag/jquery/" rel="tag">jquery</a>, <a href="http://girtby.net/archives/tag/prototype/" rel="tag">prototype</a>, <a href="http://girtby.net/archives/tag/wordpress/" rel="tag">wordpress</a></p>		    </div>
		    <div class="content">
		        <h3>Monkeying With JavaScript 
		        </h3>
		        <p>It&#8217;s funny really, one of my main reasons for switching to a Rails-based blogging platform way back when was to become more familiar with web technologies. As it turned out I never really did much of that, but since switching back to Wordpress I&#8217;ve been tinkering away madly, and astute observers may have noticed the results on this site.</p>

<p>Of course I have no real idea what I am doing. Despite having zero knowledge of PHP or JavaScript, for some reason I feel no reluctance towards sitting down at a keyboard and bashing away until I produce either Macbeth or a better website. The entire site is stored in a <a href="http://bazaar-vcs.org/">Bazaar</a> repository, and that makes reverting bad changes especially easy, and I&#8217;ll attempt to blog further about that sometime.</p>

<p>For now let me just point out a seemingly small change to the site. The dates of the posts and comments are now displayed in a more human-friendly manner such as &#8220;3 days ago&#8221; or &#8220;20 minutes later&#8221;. This was a feature of Typo that I liked enough to port to my Mephisto theme, and which (I thought) would be fairly simple to get into Wordpress.</p>

<p>It wasn&#8217;t. Read on for the war story.</p>

<p><span id="more-3674"></span></p>

<h4>The Prototype Version</h4>

<p><a href="http://www.dev411.com/blog/2007/02/05/displaying-dates-and-times-using-javascript">John Wang</a> describes how it is implemented in Typo. Basically it&#8217;s a bit of JavaScript that is run when the page loads. It looks for dates, which are delimited by the <code>abbr</code> tag and have a pre-defined CSS class. The script iterates over each of these and converts them into a friendly date. The <code>abbr</code> tag is handy because it allows you to specify the full date and time in the <code>title</code> attribute, which you can see when you hover over the date with your mouse.</p>

<p>One of the challenges with using JavaScript in this way is to ensure that you register event handlers in a manner that works with other JavaScript on the page, as well as across browsers. The <a href="http://www.prototypejs.org/">Prototype</a> library helps out immensely here, and for actually locating the <code>abbr</code> tags.</p>

<p>One of the nice features of Wordpress is that it manages dependencies on third-party JavaScript libraries, on behalf of the plugins. So as long as your plugin/theme uses the <a href="http://codex.wordpress.org/Function_Reference/wp_enqueue_script"><code>wp_enqueue_script</code></a> function, Wordpress will find a copy of the requested library and insert your script correctly into the HTML output. You call it simply from the theme&#8217;s <code>functions.php</code> file like this:</p>

<pre><code>add_action( 'wp_print_scripts', 'depo_theme_add_javascript' );

function depo_theme_add_javascript() {
    wp_enqueue_script('friendly_dates', get_bloginfo('stylesheet_directory') .
        '/javascript/friendly_dates.js', array('jquery'));
}
</code></pre>

<p>So at this point, I had the friendly date script originally from Typo, registered correctly with Wordpress and, it worked. Sort of. Specifically: when I had some of my Wordpress plugins disabled.</p>

<h4>Prototype vs jQuery</h4>

<p>Besides Prototype there are also other JavaScript libraries that people use, and they don&#8217;t always play nicely together. For example, <a href="http://jquery.com/">jQuery</a> is quite popular, and seems to be used by at least two of the wordpress plugins I have installed. Which meant that I could use my date script or the plugins, but not both.</p>

<p>Now jQuery (at least) is supposed to play nice with other libraries if you use the <a href="http://docs.jquery.com/Using_jQuery_with_Other_Libraries"><code>noConflict</code></a> method. Unfortunately I couldn&#8217;t get it to work. I even resorted to asking my first <a href="http://stackoverflow.com/questions/415550/prototype-and-jquery-peaceful-co-existence">question on Stack Overflow</a>. This seemed to stump the experts too; the best answer was basically &#8220;switch to jQuery&#8221;.</p>

<p>So that&#8217;s what I did.</p>

<h4>The jQuery Version</h4>

<p>jQuery is a quite unusual library. It reminds me a little bit of XSLT, in that you declare a pattern of matching items in the DOM tree, and for each of those, some actions which affect the output. You might even say the similarity is quite ironic, given that XSLT is the browser&#8217;s <a href="/archives/2006/06/14/the-browsers-other-scripting-language/">other scripting language</a>.</p>

<p>By chance I came across <a href="http://www.zachleat.com/web/2008/03/23/yet-another-pretty-date-javascript/">yet another pretty date JavaScript</a> from Zach Leatherman (but with ancestry tracing back to jQuery author John Resig). This allowed me to perform the article date transformations almost trivially:</p>

<pre><code>jQuery(document).ready(function() {
    jQuery("abbr.published").humane_dates();
});
</code></pre>

<p>Nice. But what about the comment dates? These require two dates, both the comment date but also the date of the article to which it belongs. The former is easy enough, but there was no easy DOM path from the comment to its article meta data. If it was XSLT I could have come up with an XPath expression, but jQuery is unfortunately not that powerful (yet?).</p>

<p>So I settled for a bit of a hack. For each comment, I inserted the article date as a hidden field in the HTML as a sibling to the date <code>abbr</code>, where it can be easily retrieved by a jQuery method.</p>

<p>It&#8217;s not an ideal solution of course, and part of me wants to (at least) put the article date in a local cache variable where it doesn&#8217;t need to looked up all the time. But another part of me just wants to get it working so that I can start the process of blogging about how I got it working&#8230;</p>

<h4>Publish and Be Damned</h4>

<p>Anyway <a href="/extras/friendly_dates.js">here&#8217;s the code</a>. I&#8217;ll find a better place for it if I make any other mods, or if there is any interest in it.</p>

<h4>Lessons Learned</h4>

<p>I&#8217;m not even sure there are many here. Perhaps:</p>

<ul>
<li>Don&#8217;t mix JavaScript libraries.</li>
<li>Learn jQuery. It&#8217;s powerful.</li>
<li>C++ is easy compared to diagnosing JavaScript bugs (ok maybe not)</li>
</ul>
		        <br clear="left" />
		    </div>
        </div><!-- end post -->

			
<!-- You can start editing here. -->


<div id="comments" class="post">

	<h3 class="comments_headers">10 Comments</h3>

</div>
	
	
			
        <div class="post" id="comment-2168">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://lovehateubuntu.blogspot.com' rel='external nofollow' class='url'>Rob Britton</a><br />
                <input type="hidden" name="post_date" value="Wed, 07 Jan 2009 22:31:12 -0500" />
                <abbr class="commented" title="Thu, 08 Jan 2009 00:43:08 -0500">8 January 2009 @ 12am</abbr><br />
                <a href="#comment-2168">#</a></p>
			</div>
			<div class="content">
				<p>Three cheers for jQuery <img src='http://girtby.net/wp-includes/images/smilies/icon_wink.gif' alt=';)' class='wp-smiley' /> </p>

<p>You can go:</p>

<p><code>$(function() {
  ...
});</code></p>

<p>instead of:</p>

<p><code>jQuery(document).ready(function() { ... });</code></p>

<p>Just looks nicer is all.</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-2170">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://blog.marxy.org' rel='external nofollow' class='url'>marxy</a><br />
                <input type="hidden" name="post_date" value="Wed, 07 Jan 2009 22:31:12 -0500" />
                <abbr class="commented" title="Thu, 08 Jan 2009 06:07:12 -0500">8 January 2009 @ 6am</abbr><br />
                <a href="#comment-2170">#</a></p>
			</div>
			<div class="content">
				<p>Django has some lovely filters for doing this in the <a href="http://docs.djangoproject.com/en/dev/ref/contrib/humanize/" rel="nofollow">humanize</a> template filters.</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-2172">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://blog.marxy.org' rel='external nofollow' class='url'>marxy</a><br />
                <input type="hidden" name="post_date" value="Wed, 07 Jan 2009 22:31:12 -0500" />
                <abbr class="commented" title="Thu, 08 Jan 2009 06:27:29 -0500">8 January 2009 @ 6am</abbr><br />
                <a href="#comment-2172">#</a></p>
			</div>
			<div class="content">
				<p>Woops, I completely missed the point I was trying to make. Why do you want to humanise dates in Javascript? Is it for localisation or something? </p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-2175">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://girtby.net' rel='external nofollow' class='url'>alastair</a><br />
                <input type="hidden" name="post_date" value="Wed, 07 Jan 2009 22:31:12 -0500" />
                <abbr class="commented" title="Thu, 08 Jan 2009 11:04:42 -0500">8 January 2009 @ 11am</abbr><br />
                <a href="#comment-2175">#</a></p>
			</div>
			<div class="content">
				<p>@Rob: I deliberately wanted to avoid all the craziness with the <code>$</code> symbol. Like I said though I don&#8217;t know much about JavaScript&#8230;</p>

<p>@marxy: Sorry I should have explained. Yes the reason for using JavaScript is to avoid re-rendering the page on the server side every time it is loaded. This also means that (in theory anyway) it can be cached. Mephisto used to do this nicely, but unfortunately Wordpress does not do this by default (but there is a plugin).</p>

<p>And not that I&#8217;ll be doing this, but JavaScript enables the possibility of dynamically update the page if you leave it open for hours/days at a time (again without re-rendering on the server).</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-2182">
		    <div class="metainfo">
                <p>Posted by<br />Chris Heald<br />
                <input type="hidden" name="post_date" value="Wed, 07 Jan 2009 22:31:12 -0500" />
                <abbr class="commented" title="Thu, 08 Jan 2009 19:00:54 -0500">8 January 2009 @ 7pm</abbr><br />
                <a href="#comment-2182">#</a></p>
			</div>
			<div class="content">
				<p>For what it&#8217;s worth, jQuery is specifically written to play nicely with other libraries; there is doc on the jQuery site about how to make it do so. It&#8217;s very clean, since jQuery is entirely written in closures, and doesn&#8217;t clutter up your global namespace.</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-2239">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://girtby.net' rel='external nofollow' class='url'>alastair</a><br />
                <input type="hidden" name="post_date" value="Wed, 07 Jan 2009 22:31:12 -0500" />
                <abbr class="commented" title="Thu, 15 Jan 2009 09:50:27 -0500">15 January 2009 @ 9am</abbr><br />
                <a href="#comment-2239">#</a></p>
			</div>
			<div class="content">
				<p>On a related note, I&#8217;ve just installed the excellent <a href="http://blog.clearskys.net/2008/05/28/google-ajax-libraries-api-plugin/" rel="nofollow">Google Ajax Libraries API plugin</a> for wordpress. The idea is that standard libraries like jQuery are served directly out of Google&#8217;s servers. Which is great because it reduces the load on your site, but also is a lot more likely to be cached and hence loads more quickly into the browser.</p>

<p>Leveraged synergy AND open kimono!</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-2269">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://bjkeefe.blogspot.com/' rel='external nofollow' class='url'>Brendan</a><br />
                <input type="hidden" name="post_date" value="Wed, 07 Jan 2009 22:31:12 -0500" />
                <abbr class="commented" title="Wed, 21 Jan 2009 13:12:58 -0500">21 January 2009 @ 1pm</abbr><br />
                <a href="#comment-2269">#</a></p>
			</div>
			<div class="content">
				<p>Maybe it&#8217;s just me, but I don&#8217;t like the relative dating schemes that you call &#8220;more human-friendly.&#8221;  I find it easier to see the absolute date and time and do any desired conversions to relative (&#8220;Ah, he posted this yesterday&#8221;) than I do going the other way.  And then there&#8217;s the annoyance of searching for and not finding a string that I expect to be there; e.g., 20 January 2009.</p>

<p>Which is not to say anything against this post, your interest in solving this problem, or your own <strike>poor</strike> taste.</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-2327">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://www.namsisi.com' rel='external nofollow' class='url'>Adam</a><br />
                <input type="hidden" name="post_date" value="Wed, 07 Jan 2009 22:31:12 -0500" />
                <abbr class="commented" title="Thu, 29 Jan 2009 18:49:44 -0500">29 January 2009 @ 6pm</abbr><br />
                <a href="#comment-2327">#</a></p>
			</div>
			<div class="content">
				<p>First, I think</p>

<p><code>jQuery(document).ready(function() { ... });</code></p>

<p>is much more readable than</p>

<p><code>$(function() { ... });</code></p>

<p>I completely understand the first row without being very knowledgeable in JavaScript. <em>&#8220;When the document is ready, run the following function.&#8221;</em> But the second row, I have no idea. Even knowing that <code>$</code> accesses an element in the page doesn&#8217;t help much.</p>

<p>Second, I think the comment dates are confusing. It is much easier to parse them relative to now. That is, I know that the post is for example 3 weeks old and Brendan&#8217;s comment is 1 week old. It is not hard to figure out when he posted it relative to the original post. Now I need to take the time of the original post + the time of the comment to figure out when it was posted. It&#8217;s just not the time conversions you&#8217;re used to make.</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-2328">
		    <div class="metainfo">
                <p>Posted by<br /><a href='http://plasmasturm.org/' rel='external nofollow' class='url'>Aristotle Pagaltzis</a><br />
                <input type="hidden" name="post_date" value="Wed, 07 Jan 2009 22:31:12 -0500" />
                <abbr class="commented" title="Thu, 29 Jan 2009 23:19:45 -0500">29 January 2009 @ 11pm</abbr><br />
                <a href="#comment-2328">#</a></p>
			</div>
			<div class="content">
				<blockquote>
  <p>I completely understand the first row without being very knowledgeable in JavaScript.</p>
</blockquote>

<p>Because obviously the most important criterion for how to write a piece of code is whether it can be read by people who don’t know the library or the language. Or programming.</p> 
							</div>
		<br clear="left" />
		</div>
			
        <div class="post" id="comment-2332">
		    <div class="metainfo">
                <p>Posted by<br />Andrew<br />
                <input type="hidden" name="post_date" value="Wed, 07 Jan 2009 22:31:12 -0500" />
                <abbr class="commented" title="Fri, 30 Jan 2009 12:36:14 -0500">30 January 2009 @ 12pm</abbr><br />
                <a href="#comment-2332">#</a></p>
			</div>
			<div class="content">
				<blockquote>
  <blockquote>
    <p>I completely understand the first row without being very knowledgeable in JavaScript.</p>
  </blockquote>
  
  <p>Because obviously the most important criterion for how to write a piece of code is whether it can be read by people who don’t know the library or the language. Or programming.</p>
</blockquote>

<p>That depends on whether you are maintaining a site as a full time professional job, or (for example) running your own small blog and tweaking it every few months. Readability can in any case be <a href="http://en.wikipedia.org/wiki/Literate&#95;programming" rel="nofollow">considered an extremely important aspect</a> of a language.</p>

<p>&#8230; and only a programmer would expect that &#8220;jQuery(document).ready(function() { &#8230; });&#8221; was readable by a non-programmer.</p> 
							</div>
		<br clear="left" />
		</div>
		
	

	<!-- Comment Form -->

	    

			
				
<div class="posttopline">
	<span class="previous">&larr; <a href="http://girtby.net/archives/2008/12/29/software-that-goes-clunk/" rel="prev">Software That Goes Clunk</a></span>
	<span class="next"><a href="http://girtby.net/archives/2009/01/11/they-dont-call-it-hardware-for-nothing/" rel="next">They Don&#8217;t Call it Hardware for Nothing</a> &rarr;</span>
</div>

<br clear="all" />

    <div class="footer">
		
        <div class="first">
        <div id="text-318154731" class="widget widget_text"><h5 class="widgettitle">Archives</h5>			<div class="textwidget"><ul>
<li><a href="/archives/2009">2009</a></li>
<li><a href="/archives/2008">2008</a></li>
<li><a href="/archives/2007">2007</a></li>
<li><a href="/archives/2006">2006</a></li>
<li><a href="/archives/2005">2005</a></li>
<li><a href="/archives/2004">2004</a></li>
</ul></div>
		</div>		</div>

        <div class="sidebar">
        <div id="text-326846052" class="widget widget_text"><h5 class="widgettitle">Leveraged Synergy</h5>			<div class="textwidget"><p>Hello, I&#8217;m Alastair Rankine. I once had a blog, and you've found it. <a href="/about/">Would you like to know more?</a></p>
<p>From time to time I made offerings to the internet. <a href="/offerings/">Would you like some?</a></p>
</div>
		</div>        </div>

        <div class="last">
        <div id="linkcat-2" class="widget widget_links"><h5 class="widgettitle">Blogroll</h5>
	<ul class='xoxo blogroll'>
<li><a href="http://bjkeefe.blogspot.com">bjkeefe</a></li>
<li><a href="http://brainsnorkel.com">brainsnorkel</a></li>
<li><a href="http://deadlybloodyserious.com">Deadly Bloody Serious</a></li>
<li><a href="http://blog.alphajuliet.com/">follicle</a></li>
<li><a href="http://madbean.com/">madbean</a></li>
<li><a href="http://marxyblog.blogspot.com">marxy&#8217;s musing on technology</a></li>
<li><a href="http://mattrubinstein.com.au">mattrubinstein.com.au</a></li>
<li><a href="http://somethinkodd.com/oddthinking">OddThinking</a></li>

	</ul>
</div>
        </div>

	    </div><!-- end footer -->

        <br clear="all" />
        
		<div class="copyright">
        	        	<span class="previous">&larr; <a href="http://girtby.net">Back to Home</a></span>
                        <p>Powered by <a href="http://wordpress.org">WordPress</a> using the <a href="http://powazek.com/posts/516">DePo Clean Theme</a> <a rel="license" href="http://creativecommons.org/licenses/by-sa/2.5/au/"><img alt="Creative Commons License" class="badge" width=80 height=15 src="http://i.creativecommons.org/l/by-sa/2.5/au/80x15.png" /></a></p>
            		</div>

	</div> <!-- end container -->
</body>
</html>
